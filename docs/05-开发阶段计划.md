# icooclaw 开发阶段计划

## 项目现状

| 组件 | 状态 | 说明 |
|------|------|------|
| main.go | ✅ 基本完成 | 启动流程已实现 |
| agent/loop | ✅ 核心完成 | ReAct 模式已实现 |
| provider/base | ⚠️ 框架完成 | 需要实现具体 Provider |
| storage/ | ⚠️ 基础完成 | 需要完善操作接口 |
| channel/ | ⚠️ 接口完成 | 需要实现具体通道 |
| scheduler/ | ⚠️ 框架完成 | 需要使用 gronx |
| bus/ | ✅ 完成 | 消息总线实现 |
| CLI | ❌ 未实现 | 需要新增 |
| MCP | ❌ 未实现 | 需要新增 |

---

## 开发阶段划分

分为 **4 个阶段**，每个阶段 2-4 周，总计约 10-16 周。

```
阶段 1: 核心功能完善（第1-4周）
├── 1.1 LLM Provider 实现
├── 1.2 消息通道实现
├── 1.3 工具系统完善
└── 1.4 CLI 交互模式

阶段 2: 扩展通道集成（第5-8周）
├── 2.1 社交平台集成
├── 2.2 邮件通道
├── 2.3 Webhook 增强
└── 2.4 通道配置管理

阶段 3: 高级功能开发（第9-12周）
├── 3.1 MCP 集成
├── 3.2 定时任务完善
├── 3.3 子代理系统
└── 3.4 内存管理增强

阶段 4: 工程化与发布（第13-16周）
├── 4.1 测试体系
├── 4.2 性能优化
├── 4.3 配置热重载
└── 4.4 文档与发布
```

---

## 阶段 1: 核心功能完善

### 目标
完成最小可用产品（MVP），实现基础的 AI 对话功能。

### 交付物
- 支持多个 LLM Provider 的对话机器人
- 支持 WebSocket 和 Webhook 消息通道
- 内置工具集
- CLI 交互模式

### 详细任务

#### 1.1 LLM Provider 实现

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T1.1.1 | 实现 OpenRouter Provider | 2d |
| T1.1.2 | 实现 OpenAI Provider | 1d |
| T1.1.3 | 实现 Anthropic Provider | 1d |
| T1.1.4 | 实现 DeepSeek Provider | 1d |
| T1.1.5 | 实现自定义端点 Provider | 1d |

**验收标准**:
- [ ] 各 Provider 能正确调用对应 API
- [ ] 支持工具调用
- [ ] 错误处理完善

#### 1.2 消息通道实现

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T1.2.1 | 实现 WebSocket 通道 | 2d |
| T1.2.2 | 实现 Webhook 通道 | 1d |

**验收标准**:
- [ ] WebSocket 支持连接、消息收发、心跳
- [ ] Webhook 支持接收消息和响应
- [ ] 消息格式正确解析

#### 1.3 工具系统完善

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T1.3.1 | 实现 HTTP 请求工具 | 1d |
| T1.3.2 | 实现文件读写工具 | 1d |
| T1.3.3 | 实现搜索工具 | 1d |
| T1.3.4 | 实现计算工具 | 0.5d |
| T1.3.5 | 实现天气查询工具 | 0.5d |

**验收标准**:
- [ ] 工具能正确注册到 Agent
- [ ] 工具调用能正确执行并返回结果
- [ ] 工具参数验证

#### 1.4 CLI 交互模式

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T1.4.1 | 实现 REPL 交互模式 | 1d |
| T1.4.2 | 实现命令历史 | 0.5d |
| T1.4.3 | 支持多行输入 | 0.5d |

**验收标准**:
- [ ] 能启动 CLI 模式进行对话
- [ ] 支持上下键浏览历史
- [ ] 支持 Ctrl+C 退出

---

## 阶段 2: 扩展通道集成

### 目标
集成主流即时通讯平台，扩大用户覆盖面。

### 交付物
- Telegram Bot
- Discord Bot
- 飞书机器人
- 钉钉机器人
- 邮件收发

### 详细任务

#### 2.1 社交平台集成

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T2.1.1 | 实现 Telegram 通道 | 2d |
| T2.1.2 | 实现 Discord 通道 | 2d |
| T2.1.3 | 实现飞书通道 | 2d |
| T2.1.4 | 实现钉钉通道 | 2d |

**验收标准**:
- [ ] 能接收和发送消息
- [ ] 支持 Markdown 格式
- [ ] 支持群组对话

#### 2.2 邮件通道

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T2.2.1 | 实现 IMAP 邮件接收 | 1d |
| T2.2.2 | 实现 SMTP 邮件发送 | 1d |

**验收标准**:
- [ ] 能定期检查邮箱新邮件
- [ ] 能回复邮件

#### 2.3 Webhook 增强

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T2.3.1 | 支持签名验证 | 0.5d |
| T2.3.2 | 支持多端点 | 0.5d |

#### 2.4 通道配置管理

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T2.4.1 | 通道启用/禁用 API | 0.5d |
| T2.4.2 | 通道状态查询 | 0.5d |

---

## 阶段 3: 高级功能开发

### 目标
实现高级特性，增强 Agent 能力。

### 交付物
- MCP 工具服务器集成
- 完善的定时任务
- 子代理系统
- 增强的内存管理

### 详细任务

#### 3.1 MCP 集成

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T3.1.1 | 实现 MCP 客户端 | 2d |
| T3.1.2 | 支持文件系统 MCP | 1d |
| T3.1.3 | 支持自定义 MCP | 1d |

**验收标准**:
- [ ] 能连接外部 MCP 服务器
- [ ] 能调用 MCP 工具

#### 3.2 定时任务完善

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T3.2.1 | 集成 gronx 库 | 1d |
| T3.2.2 | 实现 Heartbeat 唤醒 | 1d |
| T3.2.3 | 任务管理 CLI | 1d |

**验收标准**:
- [ ] Cron 表达式正确解析
- [ ] 定时任务能正确执行

#### 3.3 子代理系统

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T3.3.1 | 实现子代理架构 | 2d |
| T3.3.2 | 子代理通信机制 | 1d |
| T3.3.3 | 子代理管理 | 1d |

#### 3.4 内存管理增强

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T3.4.1 | 实现向量存储 | 2d |
| T3.4.2 | 实现记忆摘要 | 1d |
| T3.4.3 | 长期记忆检索 | 1d |

---

## 阶段 4: 工程化与发布

### 目标
完善工程实践，准备生产发布。

### 交付物
- 完整测试覆盖
- 性能优化
- 配置热重载
- 完整文档

### 详细任务

#### 4.1 测试体系

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T4.1.1 | 单元测试覆盖 | 3d |
| T4.1.2 | 集成测试 | 2d |
| T4.1.3 | CI/CD 流程 | 1d |
| T4.1.4 | 测试覆盖率报告 | 0.5d |

#### 4.2 性能优化

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T4.2.1 | 连接池优化 | 1d |
| T4.2.2 | 并发优化 | 1d |
| T4.2.3 | 内存使用优化 | 1d |

#### 4.3 配置热重载

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T4.3.1 | 配置文件监听 | 1d |
| T4.3.2 | 运行时配置更新 | 1d |

#### 4.4 文档与发布

| 任务 | 描述 | 预计工时 |
|------|------|----------|
| T4.4.1 | README 完善 | 0.5d |
| T4.4.2 | API 文档 | 1d |
| T4.4.3 | 版本发布 | 0.5d |

---

## 里程碑

| 里程碑 | 时间 | 交付物 |
|--------|------|--------|
| M1: MVP | 第4周 | 能跑通的对话机器人 |
| M2: 多通道 | 第8周 | 支持多种IM平台 |
| M3: 高级功能 | 第12周 | MCP、子代理、记忆 |
| M4: 生产就绪 | 第16周 | 可发布版本 |

---

## 验收标准

### M1: MVP
- [ ] 至少一个 Provider 能正常工作
- [ ] WebSocket 或 Webhook 通道可接收消息
- [ ] 能进行多轮对话
- [ ] 至少 3 个内置工具可用
- [ ] CLI 模式可正常对话

### M2: 多通道
- [ ] Telegram/Discord/飞书/钉钉 至少2个可用
- [ ] 邮件通道可用
- [ ] 通道可动态管理

### M3: 高级功能
- [ ] MCP 工具可正常调用
- [ ] 定时任务正确执行
- [ ] 子代理可协同工作
- [ ] 记忆可跨会话保留

### M4: 生产就绪
- [ ] 测试覆盖率 > 60%
- [ ] 无内存泄漏
- [ ] 配置可热重载
- [ ] 文档完整

---

## 开发优先级

### P0 (必须完成)
- LLM Provider 实现（至少1个）
- WebSocket 通道
- CLI 模式

### P1 (重要)
- Webhook 通道
- 工具系统
- Telegram/Discord 集成
- 定时任务

### P2 (增强)
- MCP 集成
- 子代理
- 内存管理
- 其他通道

### P3 (优化)
- 测试
- 性能优化
- 文档
