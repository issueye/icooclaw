# éœ€æ±‚åˆ†æè¯´æ˜æ–‡æ¡£

## 1.1 é¡¹ç›®æ¦‚è¿°

**nanobot** æ˜¯ä¸€ä¸ªè¶…è½»é‡çº§çš„ä¸ªäººAIåŠ©æ‰‹æ¡†æ¶ï¼Œæ ¸å¿ƒä»£ç ä»…çº¦4000è¡Œï¼Œæ”¯æŒå¤šå¹³å°æ¶ˆæ¯é€šé“é›†æˆå’Œå¤šç§å¤§è¯­è¨€æ¨¡å‹providerã€‚

## 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åˆ†æ

### 1.2.1 Agentæ ¸å¿ƒé€»è¾‘ (`nanobot/agent/`)

| æ¨¡å— | åŠŸèƒ½æè¿° | æ ¸å¿ƒç±»/æ–‡ä»¶ |
|------|----------|-------------|
| **loop.py** | Agentä¸»å¾ªç¯ï¼Œå¤„ç†LLMä¸å·¥å…·çš„äº¤äº’è¿­ä»£ | `AgentLoop` |
| **context.py** | æ„å»ºç³»ç»Ÿæç¤ºè¯å’Œæ¶ˆæ¯ä¸Šä¸‹æ–‡ | `ContextBuilder` |
| **memory.py** | ä¸¤å±‚è®°å¿†ç³»ç»Ÿï¼šMEMORY.mdï¼ˆé•¿æœŸï¼‰+ HISTORY.mdï¼ˆå†å²ï¼‰ | `MemoryStore` |
| **skills.py** | æŠ€èƒ½åŠ è½½å™¨ï¼Œæ”¯æŒæ¸è¿›å¼åŠ è½½ | `SkillsLoader` |
| **subagent.py** | åå°ä»»åŠ¡æ‰§è¡Œ | - |
| **tools/** | å†…ç½®å·¥å…·é›†ï¼ˆæ–‡ä»¶ã€shellã€webã€cronç­‰ï¼‰ | `Tool`, `ToolRegistry` |

**å…³é”®ç‰¹æ€§ï¼š**
- åŸºäºå·¥å…·è°ƒç”¨çš„Agentå¾ªç¯ï¼ˆReActæ¨¡å¼ï¼‰
- è‡ªåŠ¨å†…å­˜æ•´åˆï¼ˆconsolidationï¼‰
- æ”¯æŒMCPï¼ˆModel Context Protocolï¼‰å¤–éƒ¨å·¥å…·æœåŠ¡å™¨
- ä¼šè¯ç®¡ç†ï¼ˆSessionï¼‰

### 1.2.2 æ¶ˆæ¯é€šé“

| é€šé“ | åè®® | ç‰¹ç‚¹ |
|------|------|------|
| **WebSocket** | åŒå‘é•¿è¿æ¥ | é€šç”¨åè®®ï¼Œæ”¯æŒåŒå‘é€šä¿¡ |
| **Webhook** | HTTPå›è°ƒ | è½»é‡ï¼Œéœ€å…¬ç½‘URL |
| **Telegram** | Long Polling | ç®€å•å¯é ï¼Œæ— éœ€å…¬ç½‘IP (åç»­) |
| **Discord** | WebSocket | æ”¯æŒé•¿æ¶ˆæ¯æ‹†åˆ† (åç»­) |
| **WhatsApp** | QRç ç™»å½• | éœ€è¦Node.jsæ¡¥æ¥ (åç»­) |
| **Feishu(é£ä¹¦)** | WebSocketé•¿è¿æ¥ | æ— éœ€å…¬ç½‘IP (åç»­) |
| **DingTalk(é’‰é’‰)** | Streamæ¨¡å¼ | æ— éœ€å…¬ç½‘IP (åç»­) |
| **Slack** | Socket Mode | æ— éœ€å…¬ç½‘URL (åç»­) |
| **Email** | IMAP/SMTP | è½®è¯¢æ”¶ä¿¡ï¼ŒSMTPå›å¤ (åç»­) |
| **QQ** | WebSocket (botpy) | ä»…æ”¯æŒç§èŠ (åç»­) |
| **Mochat** | Socket.IO | è‡ªåŠ¨æ³¨å†Œé…ç½® (åç»­) |

> **å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ WebSocket å’Œ Webhookï¼Œå…¶ä»–å¹³å°åç»­é™†ç»­æ”¯æŒ**

**æ¶æ„æ¨¡å¼ï¼š**
- æŠ½è±¡åŸºç±» `BaseChannel`
- é€šé“ç®¡ç†å™¨ `ChannelManager` ç»Ÿä¸€åè°ƒ
- æ¶ˆæ¯é€šè¿‡ `MessageBus` è¿›è¡Œè·¯ç”±

### 1.2.3 LLM Provider (`nanobot/providers/`)

**æ”¯æŒçš„Providerï¼š**
- OpenRouterï¼ˆæ¨èï¼‰
- Anthropic (Claude)
- OpenAI (GPT)
- DeepSeek
- Gemini
- MiniMax
- Moonshot/Kimi
- Zhipu (æ™ºè°±GLM)
- DashScope (é˜¿é‡ŒQwen)
- VolcEngine (ç«å±±å¼•æ“)
- vLLM (æœ¬åœ°æ¨¡å‹)
- OpenAI Codex (OAuth)
- GitHub Copilot (OAuth)
- è‡ªå®šä¹‰OpenAIå…¼å®¹ç«¯ç‚¹

**æ¶æ„ç‰¹ç‚¹ï¼š**
- Provideræ³¨å†Œè¡¨æ¨¡å¼ï¼ˆ`registry.py`ï¼‰
- LiteLLMç»Ÿä¸€å°è£…
- æ”¯æŒPrompt Caching
- æ¨¡å‹å‰ç¼€è‡ªåŠ¨å¤„ç†

### 1.2.4 æŠ€èƒ½ç³»ç»Ÿ (`nanobot/skills/`)

æŠ€èƒ½æ˜¯Markdownæ–‡ä»¶ï¼ˆSKILL.mdï¼‰ï¼Œé€šè¿‡YAML frontmatterå®šä¹‰å…ƒæ•°æ®ï¼š
```yaml
---
metadata: {"nanobot":{"emoji":"ğŸŒ¤ï¸","requires":{"bins":["curl"]}}}
---
```

**å†…ç½®æŠ€èƒ½ï¼š**
- weather - å¤©æ°”æŸ¥è¯¢
- tmux - ç»ˆç«¯ä¼šè¯ç®¡ç†
- github - GitHub CLIé›†æˆ
- summarize - æ–‡æ¡£æ‘˜è¦

### 1.2.5 å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ

**Cronä»»åŠ¡ï¼š**
- å‘½ä»¤è¡Œï¼š`nanobot cron add/remove/list`
- æ”¯æŒcronè¡¨è¾¾å¼å’Œå›ºå®šé—´éš”

**HeartbeatæœåŠ¡ï¼š**
- é»˜è®¤30åˆ†é’Ÿå”¤é†’ä¸€æ¬¡
- æ£€æŸ¥ `HEARTBEAT.md` æ–‡ä»¶
- æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡å¹¶é€šçŸ¥ç”¨æˆ·

### 1.2.6 æ¶ˆæ¯æ€»çº¿ (`nanobot/bus/`)

```python
# äº‹ä»¶ç±»å‹
InboundMessage  # æ¥æ”¶çš„æ¶ˆæ¯
OutboundMessage # å‘é€çš„æ¶ˆæ¯

# æ¶ˆæ¯é˜Ÿåˆ—
MessageBus      # å¼‚æ­¥é˜Ÿåˆ—å®ç°
```

### 1.2.7 ä¼šè¯ç®¡ç† (`nanobot/session/`)

- JSONLæ ¼å¼å­˜å‚¨
- æŒ‰ `channel:chat_id` åŒºåˆ†ä¼šè¯
- è‡ªåŠ¨å†…å­˜æ•´åˆ
- ç¼“å­˜+æŒä¹…åŒ–

## 1.3 é…ç½®ç³»ç»Ÿ

é…ç½®æ–‡ä»¶ï¼š`~/.nanobot/config.json`

```json
{
  "providers": {...},
  "channels": {...},
  "agents": {...},
  "tools": {...}
}
```

## 1.4 æ ¸å¿ƒéœ€æ±‚æå–

| éœ€æ±‚ç±»åˆ« | å…·ä½“éœ€æ±‚ | ä¼˜å…ˆçº§ |
|----------|----------|--------|
| **é€šé“æ¥å…¥** | WebSocket + Webhook | P0 |
| **å¤šæ¨¡å‹æ”¯æŒ** | æ¥å…¥å¤šç§LLM Provider | P0 |
| **Agentèƒ½åŠ›** | å·¥å…·è°ƒç”¨ã€å¤šè½®å¯¹è¯ã€å†…å­˜ç®¡ç† | P0 |
| **å®šæ—¶ä»»åŠ¡** | Cronå®šæ—¶ä»»åŠ¡ + Heartbeatä¸»åŠ¨å”¤é†’ | P1 |
| **MCPæ”¯æŒ** | å¤–éƒ¨å·¥å…·æœåŠ¡å™¨é›†æˆ | P1 |
| **CLIäº¤äº’** | å‘½ä»¤è¡Œå¯¹è¯æ¨¡å¼ | P1 |
| **å¤šå¹³å°æ¥å…¥** | TG/Discord/é£ä¹¦/é’‰é’‰ç­‰ (åç»­) | P2 |
| **æŠ€èƒ½ç³»ç»Ÿ** | å¯æ‰©å±•æŠ€èƒ½æœºåˆ¶ | P2 |
| **OAuthç™»å½•** | æ”¯æŒOAuthè®¤è¯çš„Provider | P2 |
